<!--
SPDX-FileCopyrightText: 2022 KlarÃ¤lvdalens Datakonsult AB, a KDAB Group company <info@kdab.com>
SPDX-FileContributor: Andrew Hayzen <andrew.hayzen@kdab.com>

SPDX-License-Identifier: MIT OR Apache-2.0
-->

# CxxQtThread

`CxxQtThread<T>` is used for easy [threading](../concepts/threading.md) with QObjects.
The QObjects generated by CXX-Qt are neither [`Sync`](https://doc.rust-lang.org/std/marker/trait.Sync.html) nor [`Send`](https://doc.rust-lang.org/std/marker/trait.Send.html).
Therefore they may not be passed between threads nor accessed from multiple threads.

`CxxQtThread<T>` is an object that allows you to queue closures safely onto the Qt thread that the `qobject::T` lives on.
This object is `Send` and can therefore be moved into other threads.
It allows you to queue events from a different thread to occur on the thread of the `qobject::T` by using the Qt Event Loop.

To access the `CxxQtThread<T>` use the `qt_thread(&self)` method on a [`qobject::T`](./generated-qobject.md).

```rust,ignore,noplayground
{{#include ../../../examples/qml_features/rust/src/threading.rs:book_qt_thread}}
```

The `CxxQtThread<T>` can then be moved into any Rust thread.
The `queue` function can then be used to queue a lambda onto the Qt event loop:
``` rust,ignore,noplayground
fn queue(&self, f: F) -> Result<(), cxx::Exception>
  where F: impl FnOnce(ctx: Pin<&mut TQt>) + Send + 'static
```
The first argument of the lambda is a pinned mutable reference to the `qobject::T`.
With this parameter, you can then update the QObject to reflect any state changes that have occured in the background thread.

```rust,ignore,noplayground
{{#include ../../../examples/qml_features/rust/src/threading.rs:book_qt_thread_queue}}
```
[Full example](https://github.com/KDAB/cxx-qt/blob/main/examples/qml_features/rust/src/threading.rs)
