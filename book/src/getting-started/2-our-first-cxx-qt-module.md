<!--
SPDX-FileCopyrightText: 2022 KlarÃ¤lvdalens Datakonsult AB, a KDAB Group company <info@kdab.com>
SPDX-FileContributor: Leon Matthes <leon.matthes@kdab.com>

SPDX-License-Identifier: MIT OR Apache-2.0
-->

# Our first CXX-Qt module

As with all things Rust, we'll first want to create a cargo project.
```bash
cargo new --lib qml-minimal
```
Note the `--lib` option here. For this example, we will create a static library in Rust and use CMake to
link this into a C++ executable. We'll discuss details of this later, when we [integrate our Rust project with CMake](./5-cmake-integration.md).

As outlined in the previous section, to define a new QObject subclass, we'll create a Rust module within this library crate.
First, in the `src/lib.rs`, we tell Cargo about the module we're about to create, so it gets built as part of the crate:

```rust,ignore
{{#include ../../../examples/qml_minimal/rust/src/lib.rs:book_mod_statement}}
```

Now, create a `src/cxxqt_object.rs` file to define the language boundary:

```rust,ignore
{{#include ../../../examples/qml_minimal/rust/src/cxxqt_object.rs:book_cxx_qt_module}}
```

This is a lot to take in, so let's go one step at a time.
Starting with the module definition:
```rust,ignore
{{#include ../../../examples/qml_minimal/rust/src/cxxqt_object.rs:book_bridge_macro}}
```

Because we add the `#[cxx_qt::bridge]` macro to the module definition,
CXX-Qt will look inside the module for further macros which can define the QObject.

For the `#[cxx_qt::bridge]` macro to work, we first need to define the properties that will be exposed in the new C++ object.
This is done by tagging fields with `#[qproperty]`:
```rust,ignore
{{#include ../../../examples/qml_minimal/rust/src/cxxqt_object.rs:book_rustobj_struct}}
```
That means the newly created QObject subclass will have two properties as members: `number` and `string`. For names that contain multiple words, like `my_number`, CXX-Qt will perform the snake_case to camelCase conversion to fit with C++/QML naming conventions.

Note that the data types we use here are normal Rust data types.
CXX-Qt will automatically convert these types to their C++/Qt equivalent.
In our case that means:
- `number: i32` -> `int number`
- `string: UniquePtr<QString>` -> `QString string`\
For more details on the available types, see the [Qt types page](../concepts/types.md).

You might have also noticed the `impl Default for MyObject` here.
The struct needs to always be default-constructable and allows you to provide default values for your `Q_PROPERTY`s.

The name of this struct is used as the name of the C++ QObject subclass, in our case this is struct only contains properties.
However, the `#[cxx_qt::qobject]` marked struct could contain any fields we want which are Rust only.

Just because the `#[cxx_qt::qobject]` marked struct struct doesn't contain any data, that still doesn't mean its not an important part of our `MyObject` class.
That is because it actually defines the behavior of our class through its `impl`:
```rust,ignore
{{#include ../../../examples/qml_minimal/rust/src/cxxqt_object.rs:book_rustobj_impl}}
```

In our case, we define two new functions:
- `increment_number`
    - Increments the number of the `MyObject`.
    - As the number lives on the C++ side, it uses a `CppObj` wrapper which is generated by CXX-Qt and has the appropriate setters and getters for each property.
    - The name will be converted to `incrementNumber` in C++.
- `say_hello`
    - Prints a provided number and string.
    - The name will be converted to `sayHello` in C++.

Both functions are marked with the `#[qinvokable]` macro, which means the functions will be added to the C++ code of `MyObject` and will be callable from QML as well.

Apart from functions marked with the `#[qinvokable]` macro, the `#[cxx_qt::qobject]` marked struct impl is just a normal Rust struct impl and can contain normal Rust functions, which the invokable functions can call as usual.

And that's it. We've defined our first QObject subclass in Rust. That wasn't so hard, was it?

Now let's get to [using it in Qt](./3-exposing-to-qml.md).
